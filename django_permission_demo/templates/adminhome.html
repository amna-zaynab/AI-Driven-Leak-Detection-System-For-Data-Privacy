<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Privacy App</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
        :root {
            --primary-blue: #0ea5e9;
            --primary-dark: #0369a1;
            --primary-light: #38bdf8;
            --bg-dark: #0f172a;
            --bg-darker: #0a0f1e;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --text-light: #f8fafc;
            --text-gray: #cbd5e1;
            --text-dark: #94a3b8;
            --border-color: #334155;
            --border-light: #475569;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --sidebar-width: 280px;
            --header-height: 70px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background-color: var(--bg-darker);
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background-color: var(--bg-card);
            border-right: 1px solid var(--border-color);
            padding: 30px 0;
            z-index: 1000;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            padding: 0 25px 30px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 30px;
        }
        
        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }
        
        .logo i {
            font-size: 20px;
            color: white;
        }
        
        .logo-text h2 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-blue), var(--primary-light));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .logo-text p {
            font-size: 0.8rem;
            color: var(--text-gray);
            margin-top: 2px;
        }
        
        .nav-menu {
            padding: 0 20px;
        }
        
        .nav-item {
            list-style: none;
            margin-bottom: 10px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: var(--text-gray);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            background-color: rgba(14, 165, 233, 0.1);
            color: var(--primary-light);
        }
        
        .nav-link.active {
            background-color: rgba(14, 165, 233, 0.15);
            color: var(--primary-blue);
            border-left: 4px solid var(--primary-blue);
        }
        
        .nav-icon {
            font-size: 1.2rem;
            margin-right: 15px;
            width: 24px;
            text-align: center;
        }
        
        .nav-text {
            font-size: 1rem;
            font-weight: 500;
        }
        
        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background-color: var(--bg-card);
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }
        
        .header-left h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-blue), var(--primary-light));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .header-left p {
            color: var(--text-gray);
            margin-top: 5px;
            font-size: 0.95rem;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            position: relative;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .user-info h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-light);
        }
        
        .user-info p {
            font-size: 0.85rem;
            color: var(--text-gray);
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px 0;
            min-width: 200px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
        }
        
        .dropdown-menu.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-gray);
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .dropdown-item:hover {
            background-color: rgba(14, 165, 233, 0.1);
            color: var(--primary-light);
        }
        
        .dropdown-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .card {
            background-color: var(--bg-card);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            border-color: var(--primary-blue);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .card-icon.upload {
            background-color: rgba(14, 165, 233, 0.1);
            color: var(--primary-blue);
        }
        
        .card-icon.users {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .card-icon.storage {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        .card-icon.version {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }
        
        .card-title {
            font-size: 1.1rem;
            color: var(--text-gray);
            margin-bottom: 5px;
        }
        
        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-light);
        }
        
        .card-change {
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .card-change.positive {
            color: var(--success);
        }
        
        .card-change.negative {
            color: var(--error);
        }
        
        /* APK Upload Section */
        .apk-upload-section {
            background-color: var(--bg-card);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid var(--border-color);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-light);
        }
        
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 15px;
            padding: 60px 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background-color: rgba(14, 165, 233, 0.02);
        }
        
        .upload-area:hover {
            border-color: var(--primary-blue);
            background-color: rgba(14, 165, 233, 0.05);
        }
        
        .upload-area.dragover {
            border-color: var(--primary-blue);
            background-color: rgba(14, 165, 233, 0.1);
        }
        
        .upload-icon {
            font-size: 3.5rem;
            color: var(--primary-blue);
            margin-bottom: 20px;
        }
        
        .upload-text h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--text-light);
        }
        
        .upload-text p {
            color: var(--text-gray);
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .upload-button {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
        }
        
        .upload-info {
            display: none;
            margin-top: 25px;
            padding: 20px;
            background-color: rgba(14, 165, 233, 0.1);
            border-radius: 12px;
            border-left: 4px solid var(--primary-blue);
        }
        
        .upload-info.active {
            display: block;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .file-icon {
            font-size: 2rem;
            color: var(--primary-blue);
        }
        
        .file-details h4 {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        
        .file-details p {
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        .progress-bar {
            height: 10px;
            background-color: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-blue), var(--primary-light));
            width: 0%;
            transition: width 0.5s ease;
        }
        
        /* APK List Section */
        .apk-list-section {
            background-color: var(--bg-card);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid var(--border-color);
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .apk-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .apk-table th {
            background-color: rgba(14, 165, 233, 0.1);
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-light);
            border-bottom: 2px solid var(--border-color);
        }
        
        .apk-table td {
            padding: 18px 15px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-gray);
        }
        
        .apk-table tr:hover {
            background-color: rgba(14, 165, 233, 0.05);
        }
        
        .apk-table tr:last-child td {
            border-bottom: none;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-badge.active {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .status-badge.inactive {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }
        
        .status-badge.pending {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }
        
        .btn-view {
            background-color: rgba(14, 165, 233, 0.1);
            color: var(--primary-blue);
        }
        
        .btn-view:hover {
            background-color: rgba(14, 165, 233, 0.2);
        }
        
        .btn-edit {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .btn-edit:hover {
            background-color: rgba(16, 185, 129, 0.2);
        }
        
        .btn-delete {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }
        
        .btn-delete:hover {
            background-color: rgba(239, 68, 68, 0.2);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: var(--bg-card);
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            border: 1px solid var(--border-color);
            position: relative;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-light);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-gray);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .modal-close:hover {
            color: var(--error);
        }
        
        .modal-body .form-group {
            margin-bottom: 20px;
        }
        
        .modal-body .form-label {
            display: block;
            color: var(--text-gray);
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .modal-body .form-input {
            width: 100%;
            padding: 14px;
            background-color: rgba(15, 23, 42, 0.6);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .modal-body .form-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
        }
        
        .btn-secondary {
            background-color: transparent;
            color: var(--text-gray);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.05);
            border-color: var(--border-light);
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .header-right {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn {
                width: 100%;
                text-align: center;
            }
        }
        
        /* Toggle Button for Mobile */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 8px;
            width: 45px;
            height: 45px;
            font-size: 1.3rem;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 5px 15px rgba(14, 165, 233, 0.3);
        }
        
        @media (max-width: 1024px) {
            .sidebar-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="logo-container">
            <div class="logo">
                <i class="fas fa-robot"></i>
            </div>
            <div class="logo-text">
                <h2>Privacy App</h2>
                <p>Admin Dashboard</p>
            </div>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="#" class="nav-link active" id="navDashboard">
                    <div class="nav-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <span class="nav-text">Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/adminhome" class="nav-link">
                    <div class="nav-icon">
                        <i class="fas fa-upload"></i>
                    </div>
                    <span class="nav-text">APK Management</span>
                </a>
            </li>
        
            <li class="nav-item">
                <a href="/change_password" class="nav-link" >
                    <div class="nav-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                    <span class="nav-text">Change Password</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="/logout" class="nav-link" id="navLogout">
                    <div class="nav-icon">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                    <span class="nav-text">Logout</span>
                </a>
            </li>
        </ul>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>Admin Dashboard</h1>
                <p>Manage APK files, users, and system settings</p>
            </div>
            <div class="header-right">
                <div class="user-profile" id="userProfile">
                    <div class="user-avatar">AJ</div>
                    <div class="user-info">
                        <h4>Admin User</h4>
                        <p>   </p>
                    </div>
                   
                </div>
            </div>
        </header>
        
        <!-- Dashboard Cards -->
        <div class="dashboard-cards" id="dashboardSection">
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Total APK Uploads</div>
                        <div class="card-value">24</div>
                    </div>
                    <div class="card-icon upload">
                        <i class="fas fa-upload"></i>
                    </div>
                </div>
                <div class="card-change positive">
                    <i class="fas fa-arrow-up"></i> 12% from last month
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Active Users</div>
                        <div class="card-value">{{ request.session.ucount }}</div>
                    </div>
                    <div class="card-icon users">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="card-change positive">
                    <i class="fas fa-arrow-up"></i> 8% from last week
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Storage Used</div>
                        <div class="card-value">4.2 GB</div>
                    </div>
                    <div class="card-icon storage">
                        <i class="fas fa-database"></i>
                    </div>
                </div>
                <div class="card-change negative">
                    <i class="fas fa-arrow-down"></i> 2% from last month
                </div>
            </div>
        </div>
        
       {% block body %}
        <!-- APK Upload Section -->
        <section class="apk-upload-section" id="apkSection">

                <div class="section-header">
                <h2 class="section-title">Upload New APK</h2>
            </div>

            <!-- APK Upload Form -->
            <form id="apkUploadForm" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">
                        <h3>Drag & Drop APK Files</h3>
                        <p>Upload Android application packages (APK) files. Max file size: 100MB. Supported formats: .apk, .aab</p>
                    </div>

                    <!-- Hidden file input that will be triggered by click on upload area -->
                    <input type="file" id="fileInput" name="apk_file" accept=".apk,.aab" style="display: none;" required>

                    <!-- Browse button -->
                    <button type="button" class="upload-button" id="browseButton" style="margin-top: 15px;">
                        <i class="fas fa-folder-open"></i> Browse Files
                    </button>

                    <!-- APK Type Selection -->

                </div>
                    <div class="malware-benign-select" id="apkTypeSelect" style="margin-top: 20px; text-align: center; display: none;">
                        <label for="apkType" style="color: var(--text-light); font-weight: 500; margin-right: 10px;">APK Type:</label>
                        <select id="apkType" name="apk_type" style="padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border-light); background: var(--bg-card); color: var(--text-light); min-width: 150px;">
                            <option value="benign">Benign</option>
                            <option value="malware">Malware</option>
                        </select>
                    </div>

                    <!-- Submit button (initially hidden) -->
                    <button type="submit" class="upload-button" id="uploadSubmitBtn" style="margin-top: 20px; display: none;">
                        <i class="fas fa-upload"></i> Upload APK
                    </button>
            </form>

            <div class="upload-info" id="uploadInfo">
                <div class="file-info">
                    <div class="file-icon">
                        <i class="fas fa-android"></i>
                    </div>
                    <div class="file-details">
                        <h4 id="fileName">No file selected</h4>
                        <p id="fileSize">-</p>
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <div class="upload-status">
                    <p id="uploadStatus">Select a file to begin upload</p>
                </div>
            </div>

        </section>

        <!-- APK List Section -->
        <section class="apk-list-section">
            <div class="section-header">
                <h2 class="section-title">Uploaded APK Files</h2>
                <div class="table-controls">
                    <button class="btn btn-primary" id="refreshList">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="apk-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>APK Name</th>
                            <th>SIZE</th>
                            <th>Type</th>
                            <th>Upload Date</th>
                            <th>Status</th>
                            <th>Scanned By</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="apkTableBody">
                        <!-- APK rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>
       {% endblock %}
        
        <!-- User Management Section (Hidden by default) -->
        <section class="apk-list-section" id="usersSection" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">User Management</h2>
                <button class="btn btn-primary" id="addUserBtn">
                    <i class="fas fa-user-plus"></i> Add User
                </button>
            </div>
            
            <div class="table-container">
                <table class="apk-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Joined Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- User rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Settings Section (Hidden by default) -->
        <section class="apk-upload-section" id="settingsSection" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">System Settings</h2>
            </div>
            
            <div class="form-group">
                <label class="form-label">System Name</label>
                <input type="text" class="form-input" value="Privacy App Simulator">
            </div>
            
            <div class="form-group">
                <label class="form-label">Default APK Storage Limit (MB)</label>
                <input type="number" class="form-input" value="100">
            </div>
            
            <div class="form-group">
                <label class="form-label">Max Concurrent Users</label>
                <input type="number" class="form-input" value="1000">
            </div>
            
            <div class="form-group">
                <label class="form-label">Maintenance Mode</label>
                <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                    <input type="checkbox" id="maintenanceMode" style="width: 20px; height: 20px;">
                    <label for="maintenanceMode" style="color: var(--text-gray);">Enable maintenance mode</label>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-secondary">Cancel</button>
                <button class="btn-primary">Save Settings</button>
            </div>
        </section>
    </main>
    
    <!-- Change Password Modal -->
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Change Password</h2>
                <button class="modal-close" id="closePasswordModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="passwordForm">
                    <div class="form-group">
                        <label class="form-label">Current Password</label>
                        <input type="password" class="form-input" id="currentPassword" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">New Password</label>
                        <input type="password" class="form-input" id="newPassword" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirm New Password</label>
                        <input type="password" class="form-input" id="confirmPassword" required>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" id="cancelPassword">Cancel</button>
                        <button type="submit" class="btn-primary">Change Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Logout Confirmation Modal -->
    <div class="modal" id="logoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Confirm Logout</h2>
                <button class="modal-close" id="closeLogoutModal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-gray); margin-bottom: 20px;">Are you sure you want to logout from the admin dashboard?</p>
                
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancelLogout">Cancel</button>
                    <button type="button" class="btn-primary" id="confirmLogout">Yes, Logout</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const userProfile = document.getElementById('userProfile');
        const apkUploadForm = document.getElementById('apkUploadForm');
        const fileInput = document.getElementById('fileInput');
        const browseButton = document.getElementById('browseButton');
        const uploadArea = document.getElementById('uploadArea');
        const uploadSubmitBtn = document.getElementById('uploadSubmitBtn');
        const uploadInfo = document.getElementById('uploadInfo');
        const progressFill = document.getElementById('progressFill');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const uploadStatus = document.getElementById('uploadStatus');
        const apkTableBody = document.getElementById('apkTableBody');
        const refreshList = document.getElementById('refreshList');
        const navDashboard = document.getElementById('navDashboard');
        const navAPK = document.getElementById('navAPK');
        const navSettings = document.getElementById('navSettings');
        const navLogout = document.getElementById('navLogout');
        
        // Initialize the dashboard
        function initDashboard() {
            setupEventListeners();
            setActiveNav('navDashboard');
            loadAPKList();
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Sidebar toggle for mobile
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
            
            // Browse button click
            browseButton.addEventListener('click', () => {
                fileInput.click();
            });
            
            // File input change
            fileInput.addEventListener('change', handleFileSelect);
            
            // Click on upload area to trigger file input
            uploadArea.addEventListener('click', (e) => {
                if (e.target !== browseButton && e.target !== uploadSubmitBtn) {
                    fileInput.click();
                }
            });
            
            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelect({ target: fileInput });
                }
            });
            
            // Form submission
            apkUploadForm.addEventListener('submit', handleFormSubmit);
            
            // Navigation clicks
            navDashboard.addEventListener('click', (e) => {
                e.preventDefault();
                setActiveNav('navDashboard');
                showSection('dashboard');
            });
            
            navAPK.addEventListener('click', (e) => {
                e.preventDefault();
                setActiveNav('navAPK');
                showSection('apk');
            });
            
            navSettings.addEventListener('click', (e) => {
                e.preventDefault();
                setActiveNav('navSettings');
            });
            
            navLogout.addEventListener('click', (e) => {
                e.preventDefault();
                if (confirm('Are you sure you want to logout?')) {
                    window.location.href = '/logout';
                }
            });
            
            // Refresh APK list
            refreshList.addEventListener('click', loadAPKList);
        }
        
        // Handle file selection
        function handleFileSelect(e) {
            const file = fileInput.files[0];
            const apkTypeSelect = document.getElementById('apkTypeSelect');
            if (!file) {
                apkTypeSelect.style.display = 'none';
                return;
            }
            // Show APK type select only when file is chosen
            apkTypeSelect.style.display = 'block';
            // Check file type
            if (!file.name.toLowerCase().endsWith('.apk')) {
                alert('Please select an APK file!');
                fileInput.value = '';
                apkTypeSelect.style.display = 'none';
                return;
            }
            // Check file size (max 100MB)
            if (file.size > 100 * 1024 * 1024) {
                alert('File size exceeds 100MB limit!');
                fileInput.value = '';
                apkTypeSelect.style.display = 'none';
                return;
            }
            
            // Update file info display
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            
            // Show upload info and submit button
            uploadInfo.classList.add('active');
            uploadSubmitBtn.style.display = 'inline-block';
            uploadStatus.textContent = 'Ready to upload';
            progressFill.style.width = '0%';
        }
        
        // Handle form submission
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a file first!');
                return;
            }
            
            // Show uploading state
            uploadStatus.textContent = 'Uploading...';
            uploadSubmitBtn.disabled = true;
            browseButton.disabled = true;
            
            // Simulate progress (in real app, you'd use XMLHttpRequest with progress events)
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 90) {
                    progress = 90;
                    clearInterval(progressInterval);
                }
                progressFill.style.width = `${progress}%`;
            }, 200);
            
            try {
                // Get CSRF token
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                // Create FormData
                const formData = new FormData(apkUploadForm);
                
                // Send to server
                const response = await fetch('/upload_apk/', {
                    method: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': csrfToken
                    },
                    body: formData
                });
                
                clearInterval(progressInterval);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.success) {
                        // Show success
                        progressFill.style.width = '100%';
                        uploadStatus.textContent = 'Upload successful!';
                        
                        // Reset form after delay
                        setTimeout(() => {
                            resetUploadForm();
                            loadAPKList(); // Refresh the APK list
                            alert('APK uploaded successfully!');
                        }, 1500);
                    } else {
                        throw new Error(data.error || 'Upload failed');
                    }
                } else {
                    throw new Error(`Server error: ${response.status}`);
                }
            } catch (error) {
                console.error('Upload error:', error);
                uploadStatus.textContent = 'Upload failed!';
                alert('Upload failed: ' + error.message);
                
                // Reset form
                setTimeout(() => {
                    resetUploadForm();
                }, 2000);
            }
        }
        
        // Reset upload form
        function resetUploadForm() {
            apkUploadForm.reset();
            uploadInfo.classList.remove('active');
            uploadSubmitBtn.style.display = 'none';
            uploadSubmitBtn.disabled = false;
            browseButton.disabled = false;
            progressFill.style.width = '0%';
        }
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }
        
        // Load APK list from server
       // Load APK list from server
async function loadAPKList() {
    refreshList.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
    refreshList.disabled = true;
    
    try {
        const response = await fetch('/get_apk_list/');
        if (response.ok) {
            const data = await response.json();
            if (data.apks) {
                populateAPKTable(data.apks);
            } else if (data.error) {
                throw new Error(data.error);
            } else {
                throw new Error('Invalid response format');
            }
        } else {
            throw new Error('Failed to load APK list');
        }
    } catch (error) {
        console.error('Error loading APK list:', error);
        alert('Failed to load APK list: ' + error.message);
    } finally {
        refreshList.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
        refreshList.disabled = false;
    }
}

// Populate APK Table
function populateAPKTable(apks) {
    apkTableBody.innerHTML = '';
    
    if (!apks || apks.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td colspan="8" style="text-align: center; color: var(--text-gray); padding: 40px;">
                <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i><br>
                No APK files uploaded yet<br>
                <small>Upload your first APK using the form above</small>
            </td>
        `;
        apkTableBody.appendChild(row);
        return;
    }
    
    apks.forEach((apk, idx) => {
        // Determine status badge class and icon
        let statusClass = 'active';
        let statusIcon = 'fas fa-check-circle';
        if (apk.status === 'warning') {
            statusClass = 'pending';
            statusIcon = 'fas fa-exclamation-triangle';
        } else if (apk.status === 'inactive') {
            statusClass = 'inactive';
            statusIcon = 'fas fa-times-circle';
        }
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${idx + 1}</td>
            <td>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-android" style="color: var(--primary-blue);"></i>
                    <div>
                        <div style="font-weight: 600; color: var(--text-light);">${apk.name}</div>
                        <div style="font-size: 0.85rem; color: var(--text-gray);">
                            Type: ${apk.apk_type} | Permissions: ${apk.permissions_count}
                        </div>
                    </div>
                </div>
            </td>
            <td>${apk.size}</td>
            <td>${apk.apk_type}</td>
            <td>${apk.date || 'N/A'}</td>
            <td>
                <span class="status-badge ${statusClass}" title="${apk.status_text}">
                    <i class="${statusIcon}"></i> ${apk.status_text}
                </span>
            </td>
            <td>${apk.scanned_by || 'N/A'}</td>
            <td>
                <div class="action-buttons">
                    <button class="btn btn-delete" onclick="deleteAPK(${idx})" title="Delete APK">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        apkTableBody.appendChild(row);
    });
}

// View APK Details Modal
function viewAPKDetails(id) {
    // Find APK by ID
    const apk = getAPKById(id); // You'll need to implement this function
    
    if (!apk) {
        alert('APK not found');
        return;
    }
    
    const modalContent = `
        <div class="modal-header">
            <h2 class="modal-title">APK Details</h2>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <h4 style="color: var(--text-gray); margin-bottom: 8px;">Basic Information</h4>
                     <p><strong>ID:</strong> ${apk.id}</p>
                    <p><strong>Name:</strong> ${apk.name}</p>
                   
                    <p><strong>Size:</strong> ${apk.size}</p>
                    <p><strong>Upload Date:</strong> ${apk.date}</p>
                </div>
                <div>
                    <h4 style="color: var(--text-gray); margin-bottom: 8px;">Security Information</h4>
                    <p><strong>Status:</strong> ${apk.status_text}</p>
                    <p><strong>Risk Score:</strong> ${apk.risk_score}</p>
                    <p><strong>Permissions Count:</strong> ${apk.permissions_count}</p>
                    <p><strong>File Exists:</strong> ${apk.file_exists ? 'Yes' : 'No'}</p>
                </div>
            </div>
            
            <h4 style="color: var(--text-gray); margin-bottom: 10px;">Permissions (${apk.permissions_count})</h4>
            <div style="max-height: 200px; overflow-y: auto; background: rgba(15, 23, 42, 0.6); padding: 15px; border-radius: 8px;">
                ${apk.permissions && apk.permissions.length > 0 
                    ? apk.permissions.map(p => `<div style="padding: 4px 0; font-family: monospace;">${p}</div>`).join('')
                    : '<div style="color: var(--text-gray);">No permissions found</div>'
                }
            </div>
            
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal()">Close</button>
                <button class="btn-primary" onclick="downloadAPK(${id})">
                    <i class="fas fa-download"></i> Download APK
                </button>
            </div>
        </div>
    `;
    
    showModal(modalContent);
}

// Helper function to show modal
function showModal(content) {
    const modal = document.createElement('div');
    modal.className = 'modal active';
    modal.id = 'customModal';
    modal.innerHTML = `
        <div class="modal-content" style="max-width: 800px;">
            ${content}
        </div>
    `;
    document.body.appendChild(modal);
    
    // Close on background click
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeModal();
        }
    });
}

function closeModal() {
    const modal = document.getElementById('customModal');
    if (modal) {
        modal.remove();
    }
}

// Show permissions only
function showPermissions(id) {
    const apk = getAPKById(id);
    if (!apk) return;
    
    const modalContent = `
        <div class="modal-header">
            <h2 class="modal-title">APK Permissions</h2>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <p><strong>APK:</strong> ${apk.name}</p>
            <p><strong>Total Permissions:</strong> ${apk.permissions_count}</p>
            
            <h4 style="color: var(--text-gray); margin: 15px 0 10px;">Permission List</h4>
            <div style="max-height: 300px; overflow-y: auto; background: rgba(15, 23, 42, 0.6); padding: 15px; border-radius: 8px;">
                ${apk.permissions && apk.permissions.length > 0 
                    ? apk.permissions.map(p => `<div style="padding: 6px 10px; margin: 4px 0; background: rgba(14, 165, 233, 0.1); border-radius: 4px; font-family: monospace;">${p}</div>`).join('')
                    : '<div style="color: var(--text-gray); padding: 20px; text-align: center;">No permissions found</div>'
                }
            </div>
            
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal()">Close</button>
            </div>
        </div>
    `;
    
    showModal(modalContent);
}

// You'll need to implement this function to get APK by ID
function getAPKById(id) {
    // This should fetch the APK data from your loaded list
    // For now, return dummy data or implement based on your data structure
    return null;
}

// Delete APK
function deleteAPK(id) {
    if (!confirm('Are you sure you want to delete this APK?')) return;
    fetch('/delete_apk/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({ id: id })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('APK deleted successfully!');
            loadAPKList();
        } else {
            alert('Failed to delete APK: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(error => {
        alert('Error deleting APK: ' + error);
    });
}

// Initialize dashboard when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initDashboard();
    loadAPKList();
});
    </script>
</body>
</html>